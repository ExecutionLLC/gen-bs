<!DOCTYPE html>
<html>
<head>
    <title>Select2 Examples</title>
    
    <link href="assets/bootstrap/less/bootstrap.less" rel="stylesheet/less">
       <link href="assets/font-awesome-4.4.0/less/font-awesome.less" rel="stylesheet/less">
     <script src="assets/less-1.7.0.js"></script>

     <script src="assets/jquery.min.js"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    
    <script src="assets/select2-4.0.1-rc.1/dist/js/select2.full.min.js"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
 <style>
   .select2-result-repository__avatar { 
     width: 64px;
     float: left;
   }
   .select2-result-repository__avatar img { 
     max-width: 100%;
   }
   
 </style>   
</head>
<body>
<nav class="navbar navbar-default navbar-static-top">
 <div class="container-fluid">
  <div class="row grid-toolbar">
    <div class="col-sm-6 btn-group-select2">

  <select class="sample-select-ajax"></select>
  
  
</div>



 
    
  </div>
 </div>
</nav>




<script>
 
//smaples local data


/*

    function formatState (state) {
      if (!state.id) { return state.text; }
      var $state = $(
        '<span><i class="glyphicon glyphicon-file"></i>' + state.text + '</span>'
      );
      return $state;
    };

        var samples = [{ id: 0, text: 'ATCC HCC1187 TumorBL' }, { id: 1, text: 'ATCC HCC1187 TumorC' }, { id: 2, text: 'iha1' }, { id: 3, text: 'iha2' }, { id: 4, text: 'iha3' }];
         
        $(".sample-select").select2({
          data: samples,
          templateResult: formatState
        })         
         
*/


  //samples remote date
/*

            $('#appbundle_marketplace_product_ingredient_barcode').select2({
                minimumInputLength: 5,
                closeOnSelect: false,
                multiple: false,
                allowClear: true,
                quietMillis: 250,
                placeholder: 'Commencez à taper le code barre ici',
                ajax: {
                    data: function (term) {
                        return {
                            q: term // search term
                        };
                    },
                    url: function(term) {
                        url="http://fr.openfoodfacts.org/api/v0/produit/" + term +".json";
                        return url;
                    },
                    dataType: 'json',
                    results: function(data) {
                        if (data.status!=1) {return;}
                        if (data.product.complete!=1) {return;}

//                        return {results : [data]};
                        return {
                            results: $.map([data], function (item) {
                                return {
                                    text: item.product.product_name,
                                    id: item.code,
                                    data: item
                                }
                            })
                        };
                    }
                },
                formatResult : function(response)
                {
                    data=response.data;
                    console.log(data);
                    this.description =
                        '<div id="fmu_select2_ajax_result">' +
                            "<div>Nom du produit : " + data.product.product_name + "</div>" +
                            "<div>"+
                                "<img src='"+data.product.image_small_url+"'>"+
                                "<ul>" +
                                    "<li><span>Catégories</span> : " + data.product.categories + "</li>" +
                                    "<li><span>Quantité</span> : " + data.product.quantity + " - " + data.product.serving_quantity + "</li>" +
                                "</ul>" +
                                "<div>" + data.product.brands + "</div>" +
                        "</div>" +
                        '</div>'
                    ;
                    return this.description;
                },
                formatSelection: function(response)
                {
                    data=response.data;
                    return data.code + " - " + data.product.product_name;
                },
                escapeMarkup: function (m) { return m; },
                dropdownCssClass: "bigdrop"
            });
*/
var $ajax = $(".sample-select-ajax"); 
         
 function formatRepo (repo) {
      if (repo.loading) return repo.text;

      var markup = "<div class='select2-result-repository clearfix'>" +
        "<div class='select2-result-repository__meta'>" +
          "<div class='select2-result-repository__title'>" + repo.full_name + "</div>";

      if (repo.description) {
        markup += "<div class='select2-result-repository__description'>" + repo.description + "</div>";
      }

      markup += "<div class='select2-result-repository__statistics'>" +
        "<div class='select2-result-repository__forks'><i class='fa fa-flash'></i> " + repo.forks_count + " Forks</div>" +
        "<div class='select2-result-repository__stargazers'><i class='fa fa-star'></i> " + repo.stargazers_count + " Stars</div>" +
        "<div class='select2-result-repository__watchers'><i class='fa fa-eye'></i> " + repo.watchers_count + " Watchers</div>" +
      "</div>" +
      "</div></div>";

      return markup;
    }
   function formatRepoSelection (repo) {
      return repo.full_name || repo.text;
    }
 
         
  $ajax.select2({
      ajax: {
        url: "https://api.github.com/search/repositories",
        dataType: 'json',
        delay: 250,
        data: function (params) {
          return {
            q: params.term, // search term
            page: params.page
          };
        },
        processResults: function (data, params) {
          // parse the results into the format expected by Select2
          // since we are using custom formatting functions we do not need to
          // alter the remote JSON data, except to indicate that infinite
          // scrolling can be used
          params.page = params.page || 1;

          return {
            results: data.items,
            pagination: {
              more: (params.page * 30) < data.total_count
            }
          };
        },
        cache: true
      },
      escapeMarkup: function (markup) { return markup; },
      minimumInputLength: 1,
      templateResult: formatRepo,
      templateSelection: formatRepoSelection
    });

</script>     

</body>
</html>
