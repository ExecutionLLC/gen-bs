# Взаимодействие между UI и WS

## Общие определения

* **Auth token (token, токен)** - идентификатор, получаемый пользователем при логине. Используется для идентификации пользователя при последующих запросах к WS. Предполагается использовать для авторизации внешний сервис.

* **User Session** - сессия, в рамках которой происходят операции с данными и загрузка файлов. Используется для того, чтобы отличать одного пользователя от другого, а также чтобы идентифицировать client WebSocket на стороне WS, в который отправлять результаты операций.

* **Operation** - конкретная операция, совершаемая пользователем. Операции делятся по типам:
  * операции поиска (для каждого пользователя сейчас предполагается только одна активная операция поиска)
    * первоначальная фильтрация
    * последующая фильтрация с помощью поколоночных фильтров
  * операции загрузки VCF-файла

# Замечания и ограничения

* Должно быть ограниченное количество демо-сессий

# Алгоритм взаимодействия

При загрузке интерфейс:
* проверяет, есть ли сессия (например, в local storage)
  * если нет, открывает новую
* при подключении к web socket server'у отправляет в него идентификатор сессии, чтобы привязать к ней этот канал
* при логине отправляет в web-socket полученный token, чтобы он привязался к сессии

*Если нет доступных демо-сессий*, метод открытия сессии вернёт ошибку с описанием. В этом случае алгоритм взаимодействия следующий:

* залогиниться, в ответ придёт токен
* отправить токен как параметр в метод открытия сессии. Токен проверится на валидность, и будет сразу открыта пользовательская сессия.
